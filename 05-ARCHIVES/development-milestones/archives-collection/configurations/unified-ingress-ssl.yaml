# UNIFIED 013a-ANALYTICS SSL INGRESS CONFIGURATION
# Consolidated single-point ingress for all services
---
# Clean SSL Certificate for all domains
apiVersion: networking.gke.io/v1
kind: ManagedCertificate
metadata:
  name: aia-unified-ssl-cert
  namespace: global-013a-analytics
spec:
  domains:
  - "013a.tech"
  - "www.013a.tech"
  - "api.013a.tech"
  - "app.013a.tech"
---
# Unified Production Ingress - Single Entry Point
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: aia-unified-production-ingress
  namespace: global-013a-analytics
  annotations:
    kubernetes.io/ingress.class: "gce"
    kubernetes.io/ingress.global-static-ip-name: "aia-ultimate-ip"
    networking.gke.io/managed-certificates: "aia-unified-ssl-cert"
    kubernetes.io/ingress.allow-http: "false"
    ingress.gcp.kubernetes.io/force-ssl-redirect: "true"
    cloud.google.com/backend-config: '{"default": "backend-config"}'
    nginx.ingress.kubernetes.io/proxy-body-size: "50m"
    nginx.ingress.kubernetes.io/proxy-connect-timeout: "600"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "600"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "600"
spec:
  rules:
  # Main production domain - 013a.tech
  - host: 013a.tech
    http:
      paths:
      # Frontend - React App with 3D/WebXR
      - path: /
        pathType: Prefix
        backend:
          service:
            name: aia-global-frontend-service
            port:
              number: 80
      # Main API endpoints
      - path: /api
        pathType: Prefix
        backend:
          service:
            name: aia-global-backend-service
            port:
              number: 80
      # ML/AI Processing
      - path: /ml
        pathType: Prefix
        backend:
          service:
            name: aia-global-ml-service
            port:
              number: 8001
      # Enterprise Partners API
      - path: /enterprise
        pathType: Prefix
        backend:
          service:
            name: aia-global-enterprise-service
            port:
              number: 8005
      # Payment Processing
      - path: /payment
        pathType: Prefix
        backend:
          service:
            name: aia-global-payment-service
            port:
              number: 8004
      # Monitoring Dashboard
      - path: /monitoring
        pathType: Prefix
        backend:
          service:
            name: aia-global-monitoring-service
            port:
              number: 3000

  # WWW redirect
  - host: www.013a.tech
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: aia-global-frontend-service
            port:
              number: 80

  # Dedicated API subdomain
  - host: api.013a.tech
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: aia-global-backend-service
            port:
              number: 80
      - path: /ml
        pathType: Prefix
        backend:
          service:
            name: aia-global-ml-service
            port:
              number: 8001
      - path: /enterprise
        pathType: Prefix
        backend:
          service:
            name: aia-global-enterprise-service
            port:
              number: 8005
      - path: /payment
        pathType: Prefix
        backend:
          service:
            name: aia-global-payment-service
            port:
              number: 8004

  # App subdomain
  - host: app.013a.tech
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: aia-global-frontend-service
            port:
              number: 80
---
# Cross-namespace services for blue-green deployments
apiVersion: v1
kind: Service
metadata:
  name: aia-blue-main-api-cross-ns
  namespace: global-013a-analytics
spec:
  type: ExternalName
  externalName: aia-main-api-blue-service.aia-blue-production.svc.cluster.local
  ports:
  - port: 80
---
apiVersion: v1
kind: Service
metadata:
  name: aia-enterprise-services-cross-ns
  namespace: global-013a-analytics
spec:
  type: ExternalName
  externalName: aia-payment-service.aia-enterprise-services.svc.cluster.local
  ports:
  - port: 8080
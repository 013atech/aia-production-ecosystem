<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIA - Interactive Business Model Demonstration</title>
    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.162.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.162.0/examples/jsm/"
        }
    }
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #f5f5dc;
            overflow: hidden;
            height: 100vh;
        }

        .demo-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
        }

        .sidebar {
            width: 300px;
            background: rgba(26, 26, 26, 0.95);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(0, 255, 255, 0.2);
            padding: 30px;
            z-index: 100;
            overflow-y: auto;
        }

        .sidebar h2 {
            color: #00ffff;
            font-size: 1.8rem;
            margin-bottom: 30px;
            text-align: center;
            background: linear-gradient(45deg, #00ffff, #ffff00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .revenue-stream {
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.1), rgba(255, 255, 0, 0.05));
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .revenue-stream:hover {
            transform: translateX(5px);
            box-shadow: 0 10px 30px rgba(0, 255, 255, 0.2);
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.2), rgba(255, 255, 0, 0.1));
        }

        .revenue-stream.active {
            border-color: #00ffff;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.3);
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.25), rgba(255, 255, 0, 0.15));
        }

        .revenue-stream::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .revenue-stream:hover::before {
            left: 100%;
        }

        .stream-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #00ffff;
            margin-bottom: 10px;
        }

        .stream-value {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(45deg, #00ffff, #ffff00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        .stream-description {
            font-size: 0.9rem;
            color: #f5f5dc;
            opacity: 0.8;
            line-height: 1.4;
        }

        .stream-metrics {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(0, 255, 255, 0.2);
        }

        .metric {
            text-align: center;
        }

        .metric-value {
            font-size: 0.9rem;
            font-weight: 600;
            color: #ffff00;
        }

        .metric-label {
            font-size: 0.7rem;
            color: #f5f5dc;
            opacity: 0.6;
        }

        .visualization-container {
            flex: 1;
            position: relative;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
        }

        .controls {
            position: absolute;
            top: 30px;
            right: 30px;
            z-index: 200;
            display: flex;
            gap: 15px;
        }

        .control-button {
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
            color: #f5f5dc;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .control-button:hover {
            background: rgba(0, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 255, 0.2);
        }

        .control-button.active {
            background: rgba(0, 255, 255, 0.3);
            color: #00ffff;
        }

        .info-panel {
            position: absolute;
            bottom: 30px;
            left: 30px;
            right: 30px;
            background: rgba(26, 26, 26, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 255, 255, 0.2);
            border-radius: 20px;
            padding: 30px;
            z-index: 100;
            max-height: 200px;
            overflow-y: auto;
        }

        .info-title {
            font-size: 1.3rem;
            color: #00ffff;
            margin-bottom: 15px;
        }

        .info-content {
            font-size: 1rem;
            line-height: 1.6;
            color: #f5f5dc;
            opacity: 0.9;
        }

        .financial-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .summary-item {
            text-align: center;
            padding: 15px;
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.1), rgba(255, 255, 0, 0.05));
            border-radius: 10px;
            border: 1px solid rgba(0, 255, 255, 0.2);
        }

        .summary-value {
            font-size: 1.5rem;
            font-weight: 600;
            background: linear-gradient(45deg, #00ffff, #ffff00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .summary-label {
            font-size: 0.8rem;
            color: #f5f5dc;
            opacity: 0.8;
            margin-top: 5px;
        }

        .loading-spinner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            border: 3px solid rgba(0, 255, 255, 0.3);
            border-top: 3px solid #00ffff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            z-index: 1000;
        }

        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .view-toggle {
            position: absolute;
            top: 30px;
            left: 30px;
            z-index: 200;
            display: flex;
            background: rgba(26, 26, 26, 0.8);
            border-radius: 25px;
            padding: 5px;
            border: 1px solid rgba(0, 255, 255, 0.3);
        }

        .view-option {
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            color: #f5f5dc;
        }

        .view-option.active {
            background: linear-gradient(45deg, #00ffff, #ffff00);
            color: #1a1a1a;
            font-weight: 600;
        }

        .tooltip {
            position: absolute;
            background: rgba(26, 26, 26, 0.95);
            border: 1px solid rgba(0, 255, 255, 0.5);
            border-radius: 10px;
            padding: 15px;
            color: #f5f5dc;
            font-size: 0.9rem;
            max-width: 250px;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .tooltip.show {
            opacity: 1;
        }

        @media (max-width: 1024px) {
            .sidebar {
                width: 250px;
                padding: 20px;
            }
            .controls {
                top: 20px;
                right: 20px;
                gap: 10px;
            }
            .info-panel {
                bottom: 20px;
                left: 20px;
                right: 20px;
                padding: 20px;
            }
        }

        @media (max-width: 768px) {
            .demo-container {
                flex-direction: column;
            }
            .sidebar {
                width: 100%;
                height: 200px;
                overflow-x: auto;
                display: flex;
                gap: 20px;
                padding: 20px;
            }
            .revenue-stream {
                min-width: 200px;
                margin-bottom: 0;
            }
            .view-toggle {
                top: 20px;
                left: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <div class="sidebar">
            <h2>Revenue Streams</h2>

            <div class="revenue-stream active" data-stream="enterprise">
                <div class="stream-title">Enterprise SaaS</div>
                <div class="stream-value">$180M ARR</div>
                <div class="stream-description">Subscription-based enterprise intelligence platform with tiered pricing for Fortune 500 companies.</div>
                <div class="stream-metrics">
                    <div class="metric">
                        <div class="metric-value">450</div>
                        <div class="metric-label">Clients</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value">92%</div>
                        <div class="metric-label">Retention</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value">$400K</div>
                        <div class="metric-label">ARPU</div>
                    </div>
                </div>
            </div>

            <div class="revenue-stream" data-stream="consulting">
                <div class="stream-title">AI Consulting</div>
                <div class="stream-value">$45M ARR</div>
                <div class="stream-description">Strategic AI implementation consulting and custom solution development for enterprise transformation.</div>
                <div class="stream-metrics">
                    <div class="metric">
                        <div class="metric-value">150</div>
                        <div class="metric-label">Projects</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value">$300K</div>
                        <div class="metric-label">Avg Project</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value">6mo</div>
                        <div class="metric-label">Duration</div>
                    </div>
                </div>
            </div>

            <div class="revenue-stream" data-stream="marketplace">
                <div class="stream-title">AI Marketplace</div>
                <div class="stream-value">$25M ARR</div>
                <div class="stream-description">Commission-based marketplace for AI models, datasets, and specialized intelligence modules.</div>
                <div class="stream-metrics">
                    <div class="metric">
                        <div class="metric-value">15%</div>
                        <div class="metric-label">Commission</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value">2,500</div>
                        <div class="metric-label">Partners</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value">$10K</div>
                        <div class="metric-label">Avg Deal</div>
                    </div>
                </div>
            </div>

            <div class="revenue-stream" data-stream="licensing">
                <div class="stream-title">IP Licensing</div>
                <div class="stream-value">$35M ARR</div>
                <div class="stream-description">Licensing proprietary AI algorithms and autonomous intelligence frameworks to technology partners.</div>
                <div class="stream-metrics">
                    <div class="metric">
                        <div class="metric-value">25</div>
                        <div class="metric-label">Partners</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value">$1.4M</div>
                        <div class="metric-label">Avg License</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value">5yr</div>
                        <div class="metric-label">Term</div>
                    </div>
                </div>
            </div>

            <div class="revenue-stream" data-stream="data">
                <div class="stream-title">Data Intelligence</div>
                <div class="stream-value">$15M ARR</div>
                <div class="stream-description">Anonymized market intelligence and industry insights derived from aggregated platform analytics.</div>
                <div class="stream-metrics">
                    <div class="metric">
                        <div class="metric-value">1,200</div>
                        <div class="metric-label">Reports</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value">$12.5K</div>
                        <div class="metric-label">Avg Report</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value">Monthly</div>
                        <div class="metric-label">Frequency</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="visualization-container">
            <div class="loading-spinner" id="loadingSpinner"></div>

            <div class="view-toggle">
                <div class="view-option active" data-view="network">Network</div>
                <div class="view-option" data-view="flow">Flow</div>
                <div class="view-option" data-view="timeline">Timeline</div>
                <div class="view-option" data-view="hierarchy">Hierarchy</div>
            </div>

            <div class="controls">
                <button class="control-button" id="playBtn">Play</button>
                <button class="control-button" id="resetBtn">Reset</button>
                <button class="control-button" id="exportBtn">Export</button>
            </div>

            <canvas id="businessModelCanvas"></canvas>

            <div class="info-panel" id="infoPanel">
                <div class="info-title">Enterprise SaaS Revenue Stream</div>
                <div class="info-content">
                    Our core Enterprise SaaS platform generates $180M ARR through subscription-based autonomous intelligence services. With 450 Fortune 500 clients and 92% retention rate, this stream represents the foundation of sustainable revenue growth.
                </div>
                <div class="financial-summary">
                    <div class="summary-item">
                        <div class="summary-value">$300M</div>
                        <div class="summary-label">Total ARR</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">78%</div>
                        <div class="summary-label">Gross Margin</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">47%</div>
                        <div class="summary-label">YoY Growth</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">$1.2B</div>
                        <div class="summary-label">5yr Projection</div>
                    </div>
                </div>
            </div>

            <div class="tooltip" id="tooltip"></div>
        </div>
    </div>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
        import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
        import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';

        class InteractiveBusinessModel {
            constructor() {
                this.currentView = 'network';
                this.currentStream = 'enterprise';
                this.isPlaying = false;
                this.animationSpeed = 1;

                this.revenueStreams = {
                    enterprise: {
                        title: 'Enterprise SaaS',
                        value: 180,
                        color: 0x00ffff,
                        description: 'Subscription-based enterprise intelligence platform with tiered pricing for Fortune 500 companies.',
                        metrics: {
                            clients: 450,
                            retention: 92,
                            arpu: 400
                        },
                        growth: [120, 140, 160, 180, 220, 280],
                        position: { x: 0, y: 0, z: 0 }
                    },
                    consulting: {
                        title: 'AI Consulting',
                        value: 45,
                        color: 0xffff00,
                        description: 'Strategic AI implementation consulting and custom solution development for enterprise transformation.',
                        metrics: {
                            projects: 150,
                            avgProject: 300,
                            duration: 6
                        },
                        growth: [20, 28, 35, 45, 65, 90],
                        position: { x: -4, y: 2, z: -2 }
                    },
                    marketplace: {
                        title: 'AI Marketplace',
                        value: 25,
                        color: 0x00ff00,
                        description: 'Commission-based marketplace for AI models, datasets, and specialized intelligence modules.',
                        metrics: {
                            commission: 15,
                            partners: 2500,
                            avgDeal: 10
                        },
                        growth: [8, 12, 18, 25, 40, 65],
                        position: { x: 4, y: 2, z: -2 }
                    },
                    licensing: {
                        title: 'IP Licensing',
                        value: 35,
                        color: 0xff8800,
                        description: 'Licensing proprietary AI algorithms and autonomous intelligence frameworks to technology partners.',
                        metrics: {
                            partners: 25,
                            avgLicense: 1400,
                            term: 5
                        },
                        growth: [15, 22, 28, 35, 50, 75],
                        position: { x: -4, y: -2, z: -2 }
                    },
                    data: {
                        title: 'Data Intelligence',
                        value: 15,
                        color: 0xff0088,
                        description: 'Anonymized market intelligence and industry insights derived from aggregated platform analytics.',
                        metrics: {
                            reports: 1200,
                            avgReport: 12.5,
                            frequency: 'Monthly'
                        },
                        growth: [5, 8, 12, 15, 25, 40],
                        position: { x: 4, y: -2, z: -2 }
                    }
                };

                this.init();
                this.setupEventListeners();
                this.createVisualization();
                this.startAnimation();

                // Hide loading spinner
                setTimeout(() => {
                    document.getElementById('loadingSpinner').style.display = 'none';
                }, 1500);
            }

            init() {
                const canvas = document.getElementById('businessModelCanvas');
                const container = canvas.parentElement;

                // Scene setup
                this.scene = new THREE.Scene();
                this.camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
                this.renderer = new THREE.WebGLRenderer({
                    canvas: canvas,
                    antialias: true,
                    alpha: true,
                    powerPreference: "high-performance"
                });

                this.renderer.setSize(container.clientWidth, container.clientHeight);
                this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
                this.renderer.toneMapping = THREE.ACESFilmicToneMapping;
                this.renderer.toneMappingExposure = 0.8;

                // Post-processing
                this.composer = new EffectComposer(this.renderer);
                this.composer.addPass(new RenderPass(this.scene, this.camera));
                this.composer.addPass(new UnrealBloomPass(
                    new THREE.Vector2(window.innerWidth, window.innerHeight),
                    0.3, 0.1, 0.9
                ));

                // Controls
                this.controls = new OrbitControls(this.camera, this.renderer.domElement);
                this.controls.enableDamping = true;
                this.controls.dampingFactor = 0.05;
                this.controls.minDistance = 5;
                this.controls.maxDistance = 20;

                // Lighting
                this.setupLighting();

                // Camera position
                this.camera.position.set(0, 5, 15);
                this.camera.lookAt(0, 0, 0);

                // Store objects for interaction
                this.streamObjects = {};
                this.connections = [];
                this.particles = null;
                this.flowLines = [];
                this.timelineElements = [];

                // Raycaster for interaction
                this.raycaster = new THREE.Raycaster();
                this.mouse = new THREE.Vector2();
                this.hoveredObject = null;
            }

            setupLighting() {
                // Ambient light
                const ambientLight = new THREE.AmbientLight(0xffffff, 0.2);
                this.scene.add(ambientLight);

                // Main light
                const mainLight = new THREE.DirectionalLight(0x00ffff, 1);
                mainLight.position.set(10, 10, 5);
                mainLight.castShadow = true;
                this.scene.add(mainLight);

                // Accent lights
                const accentLight1 = new THREE.PointLight(0xffff00, 0.5, 50);
                accentLight1.position.set(-10, 5, -5);
                this.scene.add(accentLight1);

                const accentLight2 = new THREE.PointLight(0x00ff00, 0.3, 30);
                accentLight2.position.set(5, -5, 10);
                this.scene.add(accentLight2);

                // Dynamic light that follows mouse
                this.dynamicLight = new THREE.PointLight(0x00ffff, 0.8, 20);
                this.dynamicLight.position.set(0, 0, 5);
                this.scene.add(this.dynamicLight);
            }

            setupEventListeners() {
                // Revenue stream selection
                document.querySelectorAll('.revenue-stream').forEach(stream => {
                    stream.addEventListener('click', (e) => {
                        document.querySelectorAll('.revenue-stream').forEach(s => s.classList.remove('active'));
                        e.currentTarget.classList.add('active');
                        this.currentStream = e.currentTarget.dataset.stream;
                        this.updateInfoPanel();
                        this.highlightStream(this.currentStream);
                    });
                });

                // View toggle
                document.querySelectorAll('.view-option').forEach(option => {
                    option.addEventListener('click', (e) => {
                        document.querySelectorAll('.view-option').forEach(o => o.classList.remove('active'));
                        e.currentTarget.classList.add('active');
                        this.currentView = e.currentTarget.dataset.view;
                        this.switchView(this.currentView);
                    });
                });

                // Control buttons
                document.getElementById('playBtn').addEventListener('click', () => this.toggleAnimation());
                document.getElementById('resetBtn').addEventListener('click', () => this.resetView());
                document.getElementById('exportBtn').addEventListener('click', () => this.exportData());

                // Mouse interaction
                this.renderer.domElement.addEventListener('mousemove', (e) => this.onMouseMove(e));
                this.renderer.domElement.addEventListener('click', (e) => this.onClick(e));

                // Window resize
                window.addEventListener('resize', () => this.handleResize());

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    switch(e.key.toLowerCase()) {
                        case '1': this.switchView('network'); break;
                        case '2': this.switchView('flow'); break;
                        case '3': this.switchView('timeline'); break;
                        case '4': this.switchView('hierarchy'); break;
                        case ' ': this.toggleAnimation(); break;
                        case 'r': this.resetView(); break;
                    }
                });
            }

            createVisualization() {
                this.clearScene();

                switch(this.currentView) {
                    case 'network':
                        this.createNetworkView();
                        break;
                    case 'flow':
                        this.createFlowView();
                        break;
                    case 'timeline':
                        this.createTimelineView();
                        break;
                    case 'hierarchy':
                        this.createHierarchyView();
                        break;
                }
            }

            createNetworkView() {
                // Central hub
                const centralGeometry = new THREE.SphereGeometry(0.8, 32, 32);
                const centralMaterial = new THREE.MeshStandardMaterial({
                    color: 0xffffff,
                    metalness: 0.8,
                    roughness: 0.2,
                    emissive: 0x002244
                });
                const centralHub = new THREE.Mesh(centralGeometry, centralMaterial);
                centralHub.name = 'central';
                this.scene.add(centralHub);

                // Revenue stream nodes
                Object.entries(this.revenueStreams).forEach(([key, stream]) => {
                    const radius = stream.value * 0.02 + 0.3;
                    const geometry = new THREE.SphereGeometry(radius, 24, 24);
                    const material = new THREE.MeshStandardMaterial({
                        color: stream.color,
                        metalness: 0.7,
                        roughness: 0.3,
                        emissive: new THREE.Color(stream.color).multiplyScalar(0.1)
                    });

                    const node = new THREE.Mesh(geometry, material);
                    node.position.set(stream.position.x, stream.position.y, stream.position.z);
                    node.name = key;
                    node.userData = stream;

                    this.scene.add(node);
                    this.streamObjects[key] = node;

                    // Create connection to central hub
                    this.createConnection(centralHub.position, node.position, stream.color);

                    // Add floating text
                    this.createFloatingText(stream.title, node.position, stream.color);
                });

                // Add particle system
                this.createParticleSystem();
            }

            createFlowView() {
                // Create flow diagram showing money flow
                const flowData = [
                    { from: { x: -8, y: 3, z: 0 }, to: { x: 0, y: 0, z: 0 }, value: 180, color: 0x00ffff },
                    { from: { x: -8, y: 1, z: 0 }, to: { x: 0, y: 0, z: 0 }, value: 45, color: 0xffff00 },
                    { from: { x: -8, y: -1, z: 0 }, to: { x: 0, y: 0, z: 0 }, value: 25, color: 0x00ff00 },
                    { from: { x: -8, y: -3, z: 0 }, to: { x: 0, y: 0, z: 0 }, value: 35, color: 0xff8800 },
                    { from: { x: 0, y: 0, z: 0 }, to: { x: 8, y: 2, z: 0 }, value: 200, color: 0xff0088 },
                    { from: { x: 0, y: 0, z: 0 }, to: { x: 8, y: -2, z: 0 }, value: 85, color: 0x8800ff }
                ];

                // Central processing node
                const centralGeometry = new THREE.BoxGeometry(2, 1, 0.5);
                const centralMaterial = new THREE.MeshStandardMaterial({
                    color: 0xffffff,
                    metalness: 0.8,
                    roughness: 0.2
                });
                const central = new THREE.Mesh(centralGeometry, centralMaterial);
                this.scene.add(central);

                // Flow streams
                flowData.forEach((flow, index) => {
                    // Source node
                    const sourceGeometry = new THREE.CylinderGeometry(0.3, 0.3, flow.value * 0.02 + 0.5);
                    const sourceMaterial = new THREE.MeshStandardMaterial({
                        color: flow.color,
                        metalness: 0.6,
                        roughness: 0.4
                    });
                    const source = new THREE.Mesh(sourceGeometry, sourceMaterial);
                    source.position.copy(flow.from);
                    this.scene.add(source);

                    // Animated flow line
                    this.createAnimatedFlow(flow.from, flow.to, flow.color, flow.value);
                });
            }

            createTimelineView() {
                // 5-year growth timeline
                const years = [2025, 2026, 2027, 2028, 2029, 2030];
                const totalValues = [];

                // Calculate total values for each year
                for (let i = 0; i < 6; i++) {
                    let total = 0;
                    Object.values(this.revenueStreams).forEach(stream => {
                        total += stream.growth[i];
                    });
                    totalValues.push(total);
                }

                // Create timeline backbone
                const timelineGeometry = new THREE.CylinderGeometry(0.05, 0.05, 12);
                const timelineMaterial = new THREE.MeshStandardMaterial({ color: 0x666666 });
                const timeline = new THREE.Mesh(timelineGeometry, timelineMaterial);
                timeline.rotation.z = Math.PI / 2;
                this.scene.add(timeline);

                // Create year markers and growth bars
                years.forEach((year, index) => {
                    const x = (index - 2.5) * 2;
                    const height = totalValues[index] * 0.02;

                    // Year marker
                    const markerGeometry = new THREE.SphereGeometry(0.2, 12, 12);
                    const markerMaterial = new THREE.MeshStandardMaterial({
                        color: 0x00ffff,
                        emissive: 0x002244
                    });
                    const marker = new THREE.Mesh(markerGeometry, markerMaterial);
                    marker.position.set(x, 0, 0);
                    this.scene.add(marker);

                    // Growth bar
                    const barGeometry = new THREE.BoxGeometry(0.4, height, 0.4);
                    const barMaterial = new THREE.MeshStandardMaterial({
                        color: new THREE.Color().setHSL((index / 6), 0.7, 0.5),
                        metalness: 0.6,
                        roughness: 0.3
                    });
                    const bar = new THREE.Mesh(barGeometry, barMaterial);
                    bar.position.set(x, height / 2 + 0.5, 0);
                    this.scene.add(bar);

                    // Revenue stream breakdown
                    let stackHeight = 0.5;
                    Object.entries(this.revenueStreams).forEach(([key, stream]) => {
                        const segmentHeight = stream.growth[index] * 0.02;
                        const segmentGeometry = new THREE.BoxGeometry(0.35, segmentHeight, 0.35);
                        const segmentMaterial = new THREE.MeshStandardMaterial({
                            color: stream.color,
                            metalness: 0.7,
                            roughness: 0.2,
                            transparent: true,
                            opacity: 0.8
                        });
                        const segment = new THREE.Mesh(segmentGeometry, segmentMaterial);
                        segment.position.set(x + 0.6, stackHeight + segmentHeight / 2, 0);
                        segment.userData = { stream: key, year: year, value: stream.growth[index] };
                        this.scene.add(segment);
                        stackHeight += segmentHeight;
                    });
                });
            }

            createHierarchyView() {
                // Create hierarchical organization of revenue streams
                const levels = [
                    { streams: ['enterprise'], y: 3, radius: 1 },
                    { streams: ['consulting', 'licensing'], y: 1, radius: 0.7 },
                    { streams: ['marketplace', 'data'], y: -1, radius: 0.5 }
                ];

                levels.forEach((level, levelIndex) => {
                    level.streams.forEach((streamKey, streamIndex) => {
                        const stream = this.revenueStreams[streamKey];
                        const angle = (streamIndex / level.streams.length) * Math.PI * 2;
                        const x = Math.cos(angle) * (levelIndex + 1) * 2;
                        const z = Math.sin(angle) * (levelIndex + 1) * 2;

                        // Main node
                        const geometry = new THREE.OctahedronGeometry(level.radius);
                        const material = new THREE.MeshStandardMaterial({
                            color: stream.color,
                            metalness: 0.8,
                            roughness: 0.2,
                            wireframe: false
                        });
                        const node = new THREE.Mesh(geometry, material);
                        node.position.set(x, level.y, z);
                        node.name = streamKey;
                        node.userData = stream;
                        this.scene.add(node);
                        this.streamObjects[streamKey] = node;

                        // Connect to parent level
                        if (levelIndex > 0) {
                            const parentLevel = levels[levelIndex - 1];
                            const parentStream = parentLevel.streams[0]; // Connect to primary of previous level
                            if (this.streamObjects[parentStream]) {
                                this.createConnection(
                                    this.streamObjects[parentStream].position,
                                    node.position,
                                    stream.color
                                );
                            }
                        }

                        // Add orbital elements
                        this.createOrbitalElements(node, stream);
                    });
                });
            }

            createConnection(from, to, color) {
                const points = [from, to];
                const geometry = new THREE.BufferGeometry().setFromPoints(points);
                const material = new THREE.LineBasicMaterial({
                    color: color,
                    transparent: true,
                    opacity: 0.6,
                    linewidth: 2
                });
                const line = new THREE.Line(geometry, material);
                this.scene.add(line);
                this.connections.push(line);
                return line;
            }

            createAnimatedFlow(from, to, color, value) {
                // Create curved path
                const curve = new THREE.QuadraticBezierCurve3(
                    new THREE.Vector3(from.x, from.y, from.z),
                    new THREE.Vector3((from.x + to.x) / 2, (from.y + to.y) / 2 + 1, (from.z + to.z) / 2),
                    new THREE.Vector3(to.x, to.y, to.z)
                );

                const points = curve.getPoints(50);
                const geometry = new THREE.BufferGeometry().setFromPoints(points);
                const material = new THREE.LineBasicMaterial({
                    color: color,
                    transparent: true,
                    opacity: 0.8,
                    linewidth: Math.max(2, value * 0.05)
                });
                const line = new THREE.Line(geometry, material);
                this.scene.add(line);
                this.flowLines.push({ line, curve, value });

                // Add moving particles along the curve
                for (let i = 0; i < Math.min(10, value * 0.1); i++) {
                    const particleGeometry = new THREE.SphereGeometry(0.05, 8, 8);
                    const particleMaterial = new THREE.MeshBasicMaterial({
                        color: color,
                        transparent: true,
                        opacity: 0.8
                    });
                    const particle = new THREE.Mesh(particleGeometry, particleMaterial);
                    this.scene.add(particle);

                    // Store animation data
                    particle.userData = {
                        curve: curve,
                        speed: 0.01 + Math.random() * 0.02,
                        offset: i * 0.1,
                        time: 0
                    };
                    this.flowLines.push({ particle });
                }
            }

            createParticleSystem() {
                const particleCount = 500;
                const geometry = new THREE.BufferGeometry();
                const positions = new Float32Array(particleCount * 3);
                const colors = new Float32Array(particleCount * 3);
                const sizes = new Float32Array(particleCount);

                for (let i = 0; i < particleCount; i++) {
                    const i3 = i * 3;

                    // Random positions in a sphere
                    const radius = 15;
                    const theta = Math.random() * Math.PI * 2;
                    const phi = Math.random() * Math.PI;

                    positions[i3] = radius * Math.sin(phi) * Math.cos(theta);
                    positions[i3 + 1] = radius * Math.sin(phi) * Math.sin(theta);
                    positions[i3 + 2] = radius * Math.cos(phi);

                    // Random colors from palette
                    const colorPalette = [
                        new THREE.Color(0x00ffff),
                        new THREE.Color(0xffff00),
                        new THREE.Color(0x00ff00),
                        new THREE.Color(0xff8800),
                        new THREE.Color(0xff0088)
                    ];
                    const color = colorPalette[Math.floor(Math.random() * colorPalette.length)];
                    colors[i3] = color.r;
                    colors[i3 + 1] = color.g;
                    colors[i3 + 2] = color.b;

                    sizes[i] = Math.random() * 0.5 + 0.1;
                }

                geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
                geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
                geometry.setAttribute('size', new THREE.BufferAttribute(sizes, 1));

                const material = new THREE.PointsMaterial({
                    size: 0.2,
                    transparent: true,
                    opacity: 0.4,
                    vertexColors: true,
                    sizeAttenuation: true
                });

                this.particles = new THREE.Points(geometry, material);
                this.scene.add(this.particles);
            }

            createFloatingText(text, position, color) {
                // Simplified text representation using geometry
                const textGeometry = new THREE.PlaneGeometry(1, 0.2);
                const textMaterial = new THREE.MeshBasicMaterial({
                    color: color,
                    transparent: true,
                    opacity: 0.8
                });
                const textMesh = new THREE.Mesh(textGeometry, textMaterial);
                textMesh.position.set(position.x, position.y + 1, position.z);
                textMesh.lookAt(this.camera.position);
                this.scene.add(textMesh);
            }

            createOrbitalElements(centerNode, stream) {
                const orbitalCount = Math.min(5, stream.value / 10);

                for (let i = 0; i < orbitalCount; i++) {
                    const geometry = new THREE.SphereGeometry(0.1, 8, 8);
                    const material = new THREE.MeshStandardMaterial({
                        color: stream.color,
                        transparent: true,
                        opacity: 0.6
                    });
                    const orbital = new THREE.Mesh(geometry, material);

                    orbital.userData = {
                        center: centerNode.position,
                        radius: 1 + i * 0.3,
                        speed: 0.01 + i * 0.002,
                        offset: (i / orbitalCount) * Math.PI * 2
                    };

                    this.scene.add(orbital);
                }
            }

            switchView(viewName) {
                this.currentView = viewName;

                // Update view toggle
                document.querySelectorAll('.view-option').forEach(option => {
                    option.classList.toggle('active', option.dataset.view === viewName);
                });

                // Recreate visualization
                this.createVisualization();
            }

            toggleAnimation() {
                this.isPlaying = !this.isPlaying;
                const btn = document.getElementById('playBtn');
                btn.textContent = this.isPlaying ? 'Pause' : 'Play';
                btn.classList.toggle('active', this.isPlaying);
            }

            resetView() {
                // Reset camera position
                this.camera.position.set(0, 5, 15);
                this.controls.target.set(0, 0, 0);
                this.controls.update();

                // Reset animations
                this.isPlaying = false;
                document.getElementById('playBtn').textContent = 'Play';
                document.getElementById('playBtn').classList.remove('active');

                // Recreate scene
                this.createVisualization();
            }

            exportData() {
                const data = {
                    revenueStreams: this.revenueStreams,
                    totalARR: Object.values(this.revenueStreams).reduce((sum, stream) => sum + stream.value, 0),
                    projectedGrowth: this.calculateProjectedGrowth(),
                    timestamp: new Date().toISOString()
                };

                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'aia-business-model-data.json';
                a.click();
                URL.revokeObjectURL(url);
            }

            calculateProjectedGrowth() {
                const projections = {};
                Object.entries(this.revenueStreams).forEach(([key, stream]) => {
                    projections[key] = {
                        current: stream.value,
                        fiveYear: stream.growth[5],
                        cagr: Math.pow(stream.growth[5] / stream.value, 1/5) - 1
                    };
                });
                return projections;
            }

            highlightStream(streamKey) {
                // Reset all materials
                Object.values(this.streamObjects).forEach(obj => {
                    if (obj && obj.material) {
                        obj.material.emissive.setScalar(0.1);
                        obj.scale.setScalar(1);
                    }
                });

                // Highlight selected stream
                if (this.streamObjects[streamKey]) {
                    const obj = this.streamObjects[streamKey];
                    obj.material.emissive.setScalar(0.3);
                    obj.scale.setScalar(1.2);
                }
            }

            updateInfoPanel() {
                const stream = this.revenueStreams[this.currentStream];
                const panel = document.getElementById('infoPanel');

                const totalARR = Object.values(this.revenueStreams).reduce((sum, s) => sum + s.value, 0);
                const grossMargin = 78; // Assumed
                const yoyGrowth = 47; // Assumed
                const fiveYearProjection = totalARR * Math.pow(1.47, 5) / 1000; // In billions

                panel.innerHTML = `
                    <div class="info-title">${stream.title}</div>
                    <div class="info-content">${stream.description}</div>
                    <div class="financial-summary">
                        <div class="summary-item">
                            <div class="summary-value">$${totalARR}M</div>
                            <div class="summary-label">Total ARR</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-value">${grossMargin}%</div>
                            <div class="summary-label">Gross Margin</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-value">${yoyGrowth}%</div>
                            <div class="summary-label">YoY Growth</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-value">$${fiveYearProjection.toFixed(1)}B</div>
                            <div class="summary-label">5yr Projection</div>
                        </div>
                    </div>
                `;
            }

            onMouseMove(event) {
                const rect = this.renderer.domElement.getBoundingClientRect();
                this.mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
                this.mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;

                // Update dynamic light position
                const vector = new THREE.Vector3(this.mouse.x, this.mouse.y, 0.5);
                vector.unproject(this.camera);
                this.dynamicLight.position.copy(vector.multiplyScalar(5));

                // Raycasting for hover effects
                this.raycaster.setFromCamera(this.mouse, this.camera);
                const intersects = this.raycaster.intersectObjects(Object.values(this.streamObjects));

                // Reset previous hover
                if (this.hoveredObject && this.hoveredObject !== this.streamObjects[this.currentStream]) {
                    this.hoveredObject.material.emissive.setScalar(0.1);
                    this.hoveredObject.scale.setScalar(1);
                }

                // Apply hover effect
                if (intersects.length > 0) {
                    const obj = intersects[0].object;
                    if (obj !== this.hoveredObject) {
                        this.hoveredObject = obj;
                        if (obj !== this.streamObjects[this.currentStream]) {
                            obj.material.emissive.setScalar(0.2);
                            obj.scale.setScalar(1.1);
                        }
                        this.showTooltip(event, obj.userData || {});
                    }
                } else {
                    this.hoveredObject = null;
                    this.hideTooltip();
                }
            }

            onClick(event) {
                this.raycaster.setFromCamera(this.mouse, this.camera);
                const intersects = this.raycaster.intersectObjects(Object.values(this.streamObjects));

                if (intersects.length > 0) {
                    const obj = intersects[0].object;
                    if (obj.name && this.revenueStreams[obj.name]) {
                        // Update UI to reflect selection
                        document.querySelectorAll('.revenue-stream').forEach(s => s.classList.remove('active'));
                        const streamElement = document.querySelector(`[data-stream="${obj.name}"]`);
                        if (streamElement) {
                            streamElement.classList.add('active');
                        }

                        this.currentStream = obj.name;
                        this.updateInfoPanel();
                        this.highlightStream(this.currentStream);
                    }
                }
            }

            showTooltip(event, userData) {
                const tooltip = document.getElementById('tooltip');
                if (userData.title) {
                    tooltip.innerHTML = `
                        <strong>${userData.title}</strong><br>
                        ARR: $${userData.value}M<br>
                        ${userData.description}
                    `;
                    tooltip.style.left = event.clientX + 10 + 'px';
                    tooltip.style.top = event.clientY - 10 + 'px';
                    tooltip.classList.add('show');
                }
            }

            hideTooltip() {
                document.getElementById('tooltip').classList.remove('show');
            }

            clearScene() {
                // Remove all objects except lights and camera
                const objectsToRemove = [];
                this.scene.traverse((child) => {
                    if (child.type === 'Mesh' || child.type === 'Line' || child.type === 'Points') {
                        objectsToRemove.push(child);
                    }
                });

                objectsToRemove.forEach(obj => {
                    this.scene.remove(obj);
                    if (obj.geometry) obj.geometry.dispose();
                    if (obj.material) obj.material.dispose();
                });

                // Clear object references
                this.streamObjects = {};
                this.connections = [];
                this.flowLines = [];
                this.particles = null;
            }

            animate() {
                requestAnimationFrame(() => this.animate());

                const time = Date.now() * 0.001;

                // Animate particles
                if (this.particles) {
                    this.particles.rotation.y += 0.001;
                    this.particles.rotation.x += 0.0005;
                }

                // Animate flow particles
                if (this.isPlaying) {
                    this.flowLines.forEach(item => {
                        if (item.particle && item.particle.userData.curve) {
                            const data = item.particle.userData;
                            data.time += data.speed;
                            const t = (data.time + data.offset) % 1;
                            const position = data.curve.getPoint(t);
                            item.particle.position.copy(position);
                        }
                    });
                }

                // Animate orbital elements
                this.scene.children.forEach(child => {
                    if (child.userData && child.userData.center) {
                        const data = child.userData;
                        const angle = time * data.speed + data.offset;
                        child.position.x = data.center.x + Math.cos(angle) * data.radius;
                        child.position.z = data.center.z + Math.sin(angle) * data.radius;
                    }
                });

                // Update controls and render
                this.controls.update();
                this.composer.render();
            }

            handleResize() {
                const container = this.renderer.domElement.parentElement;

                this.camera.aspect = container.clientWidth / container.clientHeight;
                this.camera.updateProjectionMatrix();

                this.renderer.setSize(container.clientWidth, container.clientHeight);
                this.composer.setSize(container.clientWidth, container.clientHeight);
            }

            startAnimation() {
                this.animate();
                this.updateInfoPanel();
                this.highlightStream(this.currentStream);
            }
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new InteractiveBusinessModel();
        });
    </script>
</body>
</html>
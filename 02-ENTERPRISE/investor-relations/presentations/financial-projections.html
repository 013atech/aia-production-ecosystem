<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIA - Financial Projections & 3D Analytics</title>
    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.162.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.162.0/examples/jsm/"
        }
    }
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #f5f5dc;
            overflow: hidden;
            height: 100vh;
        }

        .dashboard-container {
            display: grid;
            grid-template-columns: 300px 1fr 300px;
            grid-template-rows: 60px 1fr 200px;
            height: 100vh;
            gap: 0;
        }

        .header {
            grid-column: 1 / -1;
            background: rgba(26, 26, 26, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(0, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            z-index: 1000;
        }

        .header-title {
            font-size: 1.8rem;
            background: linear-gradient(45deg, #00ffff, #ffff00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 300;
        }

        .time-period-selector {
            display: flex;
            gap: 10px;
        }

        .time-period {
            padding: 8px 16px;
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            color: #f5f5dc;
        }

        .time-period.active,
        .time-period:hover {
            background: rgba(0, 255, 255, 0.2);
            color: #00ffff;
            transform: translateY(-1px);
        }

        .metrics-sidebar {
            background: rgba(26, 26, 26, 0.95);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(0, 255, 255, 0.2);
            padding: 30px 20px;
            overflow-y: auto;
        }

        .controls-sidebar {
            background: rgba(26, 26, 26, 0.95);
            backdrop-filter: blur(20px);
            border-left: 1px solid rgba(0, 255, 255, 0.2);
            padding: 30px 20px;
            overflow-y: auto;
        }

        .sidebar-title {
            font-size: 1.2rem;
            color: #00ffff;
            margin-bottom: 25px;
            text-align: center;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(0, 255, 255, 0.2);
        }

        .metric-card {
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.1), rgba(255, 255, 0, 0.05));
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 255, 255, 0.2);
        }

        .metric-card.active {
            border-color: #00ffff;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        }

        .metric-title {
            font-size: 0.9rem;
            color: #ffff00;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(45deg, #00ffff, #ffff00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 5px;
        }

        .metric-change {
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .metric-change.positive {
            color: #00ff88;
        }

        .metric-change.negative {
            color: #ff4488;
        }

        .metric-trend {
            width: 100%;
            height: 30px;
            margin-top: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            position: relative;
            overflow: hidden;
        }

        .trend-line {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 100%;
            background: linear-gradient(90deg, transparent, #00ffff, #ffff00);
            border-radius: 5px;
            transition: width 1s ease;
        }

        .control-group {
            margin-bottom: 30px;
        }

        .control-title {
            font-size: 1rem;
            color: #ffff00;
            margin-bottom: 15px;
            font-weight: 500;
        }

        .control-item {
            margin-bottom: 15px;
        }

        .control-label {
            font-size: 0.9rem;
            color: #f5f5dc;
            margin-bottom: 8px;
            display: block;
        }

        .control-slider {
            width: 100%;
            height: 6px;
            background: rgba(0, 255, 255, 0.2);
            border-radius: 3px;
            outline: none;
            appearance: none;
        }

        .control-slider::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            background: linear-gradient(45deg, #00ffff, #ffff00);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }

        .scenario-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .scenario-btn {
            padding: 12px;
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 10px;
            color: #f5f5dc;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            text-align: center;
        }

        .scenario-btn:hover {
            background: rgba(0, 255, 255, 0.2);
            transform: translateY(-1px);
        }

        .scenario-btn.active {
            background: rgba(0, 255, 255, 0.3);
            color: #00ffff;
            border-color: #00ffff;
        }

        .main-visualization {
            position: relative;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            overflow: hidden;
        }

        .chart-overlay {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            pointer-events: none;
        }

        .chart-legend {
            background: rgba(26, 26, 26, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 255, 255, 0.2);
            border-radius: 10px;
            padding: 15px;
            pointer-events: auto;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 0.8rem;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
            margin-right: 8px;
        }

        .chart-controls {
            display: flex;
            gap: 10px;
        }

        .chart-btn {
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 8px;
            padding: 8px 12px;
            color: #f5f5dc;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8rem;
            pointer-events: auto;
        }

        .chart-btn:hover {
            background: rgba(0, 255, 255, 0.2);
        }

        .chart-btn.active {
            background: rgba(0, 255, 255, 0.3);
            color: #00ffff;
        }

        .insights-panel {
            grid-column: 1 / -1;
            background: rgba(26, 26, 26, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(0, 255, 255, 0.2);
            padding: 25px 30px;
            overflow-y: auto;
        }

        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }

        .insight-card {
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.1), rgba(255, 255, 0, 0.05));
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 15px;
            padding: 20px;
            position: relative;
        }

        .insight-title {
            font-size: 1rem;
            color: #00ffff;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .insight-content {
            font-size: 0.9rem;
            line-height: 1.5;
            color: #f5f5dc;
            opacity: 0.9;
        }

        .insight-value {
            font-size: 1.5rem;
            font-weight: 600;
            background: linear-gradient(45deg, #00ffff, #ffff00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-top: 10px;
        }

        .loading-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            background: rgba(26, 26, 26, 0.9);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            border: 1px solid rgba(0, 255, 255, 0.3);
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(0, 255, 255, 0.3);
            border-top: 3px solid #00ffff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        .loading-text {
            color: #00ffff;
            font-size: 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .tooltip {
            position: absolute;
            background: rgba(26, 26, 26, 0.95);
            border: 1px solid rgba(0, 255, 255, 0.5);
            border-radius: 8px;
            padding: 10px;
            font-size: 0.8rem;
            color: #f5f5dc;
            pointer-events: none;
            z-index: 2000;
            opacity: 0;
            transition: opacity 0.3s ease;
            max-width: 200px;
        }

        .tooltip.show {
            opacity: 1;
        }

        @media (max-width: 1200px) {
            .dashboard-container {
                grid-template-columns: 250px 1fr 250px;
            }
        }

        @media (max-width: 1024px) {
            .dashboard-container {
                grid-template-columns: 1fr;
                grid-template-rows: 60px 200px 1fr 180px;
            }

            .metrics-sidebar,
            .controls-sidebar {
                display: flex;
                gap: 20px;
                padding: 20px;
                overflow-x: auto;
            }

            .metric-card {
                min-width: 200px;
                margin-bottom: 0;
            }

            .control-group {
                min-width: 180px;
                margin-bottom: 0;
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 0 15px;
            }

            .header-title {
                font-size: 1.4rem;
            }

            .time-period-selector {
                display: none;
            }

            .insights-panel {
                padding: 15px;
            }

            .insights-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <header class="header">
            <h1 class="header-title">AIA Financial Projections</h1>
            <div class="time-period-selector">
                <div class="time-period" data-period="1">1 Year</div>
                <div class="time-period" data-period="3">3 Years</div>
                <div class="time-period active" data-period="5">5 Years</div>
                <div class="time-period" data-period="10">10 Years</div>
            </div>
        </header>

        <aside class="metrics-sidebar">
            <h3 class="sidebar-title">Key Metrics</h3>

            <div class="metric-card active" data-metric="revenue">
                <div class="metric-title">Total Revenue</div>
                <div class="metric-value" id="revenueValue">$300M</div>
                <div class="metric-change positive">
                    <span>↗ +47% YoY</span>
                </div>
                <div class="metric-trend">
                    <div class="trend-line" style="width: 85%;"></div>
                </div>
            </div>

            <div class="metric-card" data-metric="arr">
                <div class="metric-title">Annual Recurring Revenue</div>
                <div class="metric-value" id="arrValue">$285M</div>
                <div class="metric-change positive">
                    <span>↗ +52% YoY</span>
                </div>
                <div class="metric-trend">
                    <div class="trend-line" style="width: 92%;"></div>
                </div>
            </div>

            <div class="metric-card" data-metric="margin">
                <div class="metric-title">Gross Margin</div>
                <div class="metric-value" id="marginValue">78%</div>
                <div class="metric-change positive">
                    <span>↗ +3.2% YoY</span>
                </div>
                <div class="metric-trend">
                    <div class="trend-line" style="width: 78%;"></div>
                </div>
            </div>

            <div class="metric-card" data-metric="valuation">
                <div class="metric-title">Company Valuation</div>
                <div class="metric-value" id="valuationValue">$12B</div>
                <div class="metric-change positive">
                    <span>↗ +125% YoY</span>
                </div>
                <div class="metric-trend">
                    <div class="trend-line" style="width: 95%;"></div>
                </div>
            </div>

            <div class="metric-card" data-metric="customers">
                <div class="metric-title">Enterprise Customers</div>
                <div class="metric-value" id="customersValue">485</div>
                <div class="metric-change positive">
                    <span>↗ +38% YoY</span>
                </div>
                <div class="metric-trend">
                    <div class="trend-line" style="width: 68%;"></div>
                </div>
            </div>

            <div class="metric-card" data-metric="retention">
                <div class="metric-title">Net Revenue Retention</div>
                <div class="metric-value" id="retentionValue">142%</div>
                <div class="metric-change positive">
                    <span>↗ +12% YoY</span>
                </div>
                <div class="metric-trend">
                    <div class="trend-line" style="width: 89%;"></div>
                </div>
            </div>
        </aside>

        <main class="main-visualization">
            <div class="loading-indicator" id="loadingIndicator">
                <div class="spinner"></div>
                <div class="loading-text">Generating Financial Models...</div>
            </div>

            <div class="chart-overlay">
                <div class="chart-legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #00ffff;"></div>
                        <span>Total Revenue</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ffff00;"></div>
                        <span>Operating Expenses</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #00ff00;"></div>
                        <span>Net Profit</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ff8800;"></div>
                        <span>Free Cash Flow</span>
                    </div>
                </div>

                <div class="chart-controls">
                    <div class="chart-btn active" data-chart="3d">3D View</div>
                    <div class="chart-btn" data-chart="2d">2D View</div>
                    <div class="chart-btn" data-chart="table">Table</div>
                    <div class="chart-btn" data-chart="export">Export</div>
                </div>
            </div>

            <canvas id="financialCanvas"></canvas>
        </main>

        <aside class="controls-sidebar">
            <h3 class="sidebar-title">Scenario Planning</h3>

            <div class="control-group">
                <div class="control-title">Growth Scenarios</div>
                <div class="scenario-buttons">
                    <div class="scenario-btn" data-scenario="conservative">Conservative</div>
                    <div class="scenario-btn active" data-scenario="baseline">Baseline</div>
                    <div class="scenario-btn" data-scenario="optimistic">Optimistic</div>
                    <div class="scenario-btn" data-scenario="aggressive">Aggressive</div>
                </div>
            </div>

            <div class="control-group">
                <div class="control-title">Model Parameters</div>

                <div class="control-item">
                    <label class="control-label">Market Growth Rate</label>
                    <input type="range" class="control-slider" id="marketGrowth" min="10" max="60" value="35">
                    <span id="marketGrowthValue">35%</span>
                </div>

                <div class="control-item">
                    <label class="control-label">Customer Acquisition</label>
                    <input type="range" class="control-slider" id="customerAcq" min="20" max="80" value="45">
                    <span id="customerAcqValue">45%</span>
                </div>

                <div class="control-item">
                    <label class="control-label">Pricing Premium</label>
                    <input type="range" class="control-slider" id="pricingPremium" min="0" max="50" value="25">
                    <span id="pricingPremiumValue">25%</span>
                </div>

                <div class="control-item">
                    <label class="control-label">Operating Leverage</label>
                    <input type="range" class="control-slider" id="opLeverage" min="10" max="40" value="22">
                    <span id="opLeverageValue">22%</span>
                </div>
            </div>

            <div class="control-group">
                <div class="control-title">Risk Factors</div>

                <div class="control-item">
                    <label class="control-label">Market Risk</label>
                    <input type="range" class="control-slider" id="marketRisk" min="0" max="30" value="12">
                    <span id="marketRiskValue">12%</span>
                </div>

                <div class="control-item">
                    <label class="control-label">Competition Risk</label>
                    <input type="range" class="control-slider" id="compRisk" min="0" max="40" value="18">
                    <span id="compRiskValue">18%</span>
                </div>

                <div class="control-item">
                    <label class="control-label">Technology Risk</label>
                    <input type="range" class="control-slider" id="techRisk" min="0" max="25" value="8">
                    <span id="techRiskValue">8%</span>
                </div>
            </div>
        </aside>

        <section class="insights-panel">
            <div class="insights-grid">
                <div class="insight-card">
                    <div class="insight-title">Revenue Trajectory</div>
                    <div class="insight-content">
                        Strong growth trajectory driven by enterprise adoption and AI market expansion. Revenue projected to reach $1.2B by 2030 with 47% CAGR.
                    </div>
                    <div class="insight-value">$1.2B by 2030</div>
                </div>

                <div class="insight-card">
                    <div class="insight-title">Market Opportunity</div>
                    <div class="insight-content">
                        Capturing 0.05% of the $2.3T AI market with significant expansion potential across Fortune 500 enterprises and emerging markets.
                    </div>
                    <div class="insight-value">$2.3T TAM</div>
                </div>

                <div class="insight-card">
                    <div class="insight-title">Profitability Path</div>
                    <div class="insight-content">
                        EBITDA positive by Q3 2025, with margins improving from 15% to 35% as platform scales and operational leverage increases.
                    </div>
                    <div class="insight-value">35% EBITDA Margin</div>
                </div>

                <div class="insight-card">
                    <div class="insight-title">Cash Generation</div>
                    <div class="insight-content">
                        Free cash flow turning positive in 2026 with $500M+ annual generation by 2030, supporting self-funded growth and strategic investments.
                    </div>
                    <div class="insight-value">$500M+ FCF</div>
                </div>

                <div class="insight-card">
                    <div class="insight-title">Valuation Multiple</div>
                    <div class="insight-content">
                        Trading at 8x revenue multiple in line with high-growth SaaS companies, with potential for 12-15x multiple as profitability scales.
                    </div>
                    <div class="insight-value">8-15x Revenue</div>
                </div>

                <div class="insight-card">
                    <div class="insight-title">Investment Returns</div>
                    <div class="insight-content">
                        Projected IRR of 45-65% for current round investors with multiple exit scenarios including strategic acquisition or IPO by 2028.
                    </div>
                    <div class="insight-value">45-65% IRR</div>
                </div>
            </div>
        </section>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
        import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
        import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';

        class FinancialDashboard {
            constructor() {
                this.currentPeriod = 5;
                this.currentScenario = 'baseline';
                this.currentMetric = 'revenue';
                this.currentChart = '3d';

                // Financial data models
                this.scenarios = {
                    conservative: { growth: 0.25, margin: 0.05, risk: 0.3 },
                    baseline: { growth: 0.47, margin: 0.1, risk: 0.15 },
                    optimistic: { growth: 0.65, margin: 0.15, risk: 0.08 },
                    aggressive: { growth: 0.85, margin: 0.2, risk: 0.25 }
                };

                this.baseData = {
                    revenue: [200, 300, 440, 650, 950, 1200],
                    expenses: [180, 240, 320, 420, 550, 680],
                    profit: [20, 60, 120, 230, 400, 520],
                    cashflow: [-50, 10, 80, 180, 320, 450]
                };

                this.parameters = {
                    marketGrowth: 35,
                    customerAcq: 45,
                    pricingPremium: 25,
                    opLeverage: 22,
                    marketRisk: 12,
                    compRisk: 18,
                    techRisk: 8
                };

                this.init();
                this.setupEventListeners();
                this.createVisualization();
                this.startAnimation();

                // Hide loading after initialization
                setTimeout(() => {
                    document.getElementById('loadingIndicator').style.opacity = '0';
                    setTimeout(() => {
                        document.getElementById('loadingIndicator').style.display = 'none';
                    }, 500);
                }, 2500);
            }

            init() {
                const canvas = document.getElementById('financialCanvas');
                const container = canvas.parentElement;

                // Scene setup
                this.scene = new THREE.Scene();
                this.camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
                this.renderer = new THREE.WebGLRenderer({
                    canvas: canvas,
                    antialias: true,
                    alpha: true,
                    powerPreference: "high-performance"
                });

                this.renderer.setSize(container.clientWidth, container.clientHeight);
                this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
                this.renderer.toneMapping = THREE.ACESFilmicToneMapping;
                this.renderer.toneMappingExposure = 1.2;

                // Post-processing
                this.composer = new EffectComposer(this.renderer);
                this.composer.addPass(new RenderPass(this.scene, this.camera));
                this.composer.addPass(new UnrealBloomPass(
                    new THREE.Vector2(window.innerWidth, window.innerHeight),
                    0.3, 0.1, 0.9
                ));

                // Controls
                this.controls = new OrbitControls(this.camera, this.renderer.domElement);
                this.controls.enableDamping = true;
                this.controls.dampingFactor = 0.05;
                this.controls.minDistance = 10;
                this.controls.maxDistance = 50;

                // Lighting
                this.setupLighting();

                // Camera position
                this.camera.position.set(0, 15, 25);
                this.camera.lookAt(0, 0, 0);

                // Storage for chart objects
                this.chartObjects = [];
                this.animationMixers = [];

                // Interaction
                this.raycaster = new THREE.Raycaster();
                this.mouse = new THREE.Vector2();
            }

            setupLighting() {
                // Ambient light
                const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
                this.scene.add(ambientLight);

                // Main directional light
                const mainLight = new THREE.DirectionalLight(0x00ffff, 1.5);
                mainLight.position.set(20, 20, 10);
                mainLight.castShadow = true;
                this.scene.add(mainLight);

                // Accent lights
                const accentLight1 = new THREE.PointLight(0xffff00, 0.8, 40);
                accentLight1.position.set(-15, 10, -10);
                this.scene.add(accentLight1);

                const accentLight2 = new THREE.PointLight(0x00ff00, 0.6, 30);
                accentLight2.position.set(15, -5, 10);
                this.scene.add(accentLight2);

                // Dynamic lights for data points
                this.dataLights = [];
                for (let i = 0; i < 6; i++) {
                    const light = new THREE.PointLight(0xff8800, 0.5, 15);
                    light.position.set((i - 2.5) * 4, 0, 0);
                    this.scene.add(light);
                    this.dataLights.push(light);
                }
            }

            setupEventListeners() {
                // Time period selection
                document.querySelectorAll('.time-period').forEach(period => {
                    period.addEventListener('click', (e) => {
                        document.querySelectorAll('.time-period').forEach(p => p.classList.remove('active'));
                        e.currentTarget.classList.add('active');
                        this.currentPeriod = parseInt(e.currentTarget.dataset.period);
                        this.updateVisualization();
                    });
                });

                // Metric selection
                document.querySelectorAll('.metric-card').forEach(card => {
                    card.addEventListener('click', (e) => {
                        document.querySelectorAll('.metric-card').forEach(c => c.classList.remove('active'));
                        e.currentTarget.classList.add('active');
                        this.currentMetric = e.currentTarget.dataset.metric;
                        this.highlightMetric(this.currentMetric);
                    });
                });

                // Scenario selection
                document.querySelectorAll('.scenario-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.scenario-btn').forEach(b => b.classList.remove('active'));
                        e.currentTarget.classList.add('active');
                        this.currentScenario = e.currentTarget.dataset.scenario;
                        this.updateScenario();
                    });
                });

                // Chart type selection
                document.querySelectorAll('[data-chart]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const chartType = e.currentTarget.dataset.chart;
                        if (chartType === 'export') {
                            this.exportData();
                            return;
                        }

                        document.querySelectorAll('[data-chart]').forEach(b => b.classList.remove('active'));
                        e.currentTarget.classList.add('active');
                        this.currentChart = chartType;
                        this.switchChartType(chartType);
                    });
                });

                // Parameter sliders
                Object.keys(this.parameters).forEach(param => {
                    const slider = document.getElementById(param);
                    const valueSpan = document.getElementById(param + 'Value');

                    if (slider && valueSpan) {
                        slider.addEventListener('input', (e) => {
                            const value = parseInt(e.target.value);
                            this.parameters[param] = value;
                            valueSpan.textContent = value + '%';
                            this.recalculateProjections();
                        });
                    }
                });

                // Mouse interaction
                this.renderer.domElement.addEventListener('mousemove', (e) => this.onMouseMove(e));
                this.renderer.domElement.addEventListener('click', (e) => this.onClick(e));

                // Window resize
                window.addEventListener('resize', () => this.handleResize());

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    switch(e.key) {
                        case '1': this.selectPeriod(1); break;
                        case '3': this.selectPeriod(3); break;
                        case '5': this.selectPeriod(5); break;
                        case 'b': this.selectScenario('baseline'); break;
                        case 'o': this.selectScenario('optimistic'); break;
                        case 'c': this.selectScenario('conservative'); break;
                        case 'e': this.exportData(); break;
                    }
                });
            }

            createVisualization() {
                this.clearScene();
                this.create3DChart();
                this.updateMetrics();
            }

            create3DChart() {
                const years = [2025, 2026, 2027, 2028, 2029, 2030];
                const data = this.getCurrentData();

                // Create base platform
                const platformGeometry = new THREE.BoxGeometry(24, 0.2, 16);
                const platformMaterial = new THREE.MeshStandardMaterial({
                    color: 0x333333,
                    metalness: 0.8,
                    roughness: 0.2,
                    transparent: true,
                    opacity: 0.7
                });
                const platform = new THREE.Mesh(platformGeometry, platformMaterial);
                platform.position.y = -1;
                this.scene.add(platform);

                // Create grid lines
                this.createGridLines();

                // Create data series
                this.createRevenueSeries(data.revenue, 0x00ffff, 2);
                this.createRevenueSeries(data.expenses, 0xffff00, 0);
                this.createRevenueSeries(data.profit, 0x00ff00, -2);
                this.createRevenueSeries(data.cashflow, 0xff8800, -4);

                // Create connecting surfaces
                this.createConnectingSurfaces(data);

                // Create year labels
                this.createYearLabels(years);

                // Create animated particles
                this.createDataParticles(data);
            }

            createGridLines() {
                const gridMaterial = new THREE.LineBasicMaterial({
                    color: 0x444444,
                    transparent: true,
                    opacity: 0.5
                });

                // Horizontal grid lines
                for (let i = 0; i <= 20; i++) {
                    const points = [
                        new THREE.Vector3(-12, i * 2 - 2, -8),
                        new THREE.Vector3(12, i * 2 - 2, -8)
                    ];
                    const geometry = new THREE.BufferGeometry().setFromPoints(points);
                    const line = new THREE.Line(geometry, gridMaterial);
                    this.scene.add(line);
                }

                // Vertical grid lines
                for (let i = 0; i <= 6; i++) {
                    const points = [
                        new THREE.Vector3(-12 + i * 4, -2, -8),
                        new THREE.Vector3(-12 + i * 4, 38, -8)
                    ];
                    const geometry = new THREE.BufferGeometry().setFromPoints(points);
                    const line = new THREE.Line(geometry, gridMaterial);
                    this.scene.add(line);
                }

                // Depth grid lines
                for (let i = 0; i <= 4; i++) {
                    const points = [
                        new THREE.Vector3(-12, -2, -8 + i * 4),
                        new THREE.Vector3(12, -2, -8 + i * 4)
                    ];
                    const geometry = new THREE.BufferGeometry().setFromPoints(points);
                    const line = new THREE.Line(geometry, gridMaterial);
                    this.scene.add(line);
                }
            }

            createRevenueSeries(data, color, zOffset) {
                const bars = [];

                data.forEach((value, index) => {
                    const height = Math.max(value * 0.03, 0.1);
                    const geometry = new THREE.BoxGeometry(1.5, height, 1.5);
                    const material = new THREE.MeshStandardMaterial({
                        color: color,
                        metalness: 0.7,
                        roughness: 0.3,
                        emissive: new THREE.Color(color).multiplyScalar(0.1)
                    });

                    const bar = new THREE.Mesh(geometry, material);
                    bar.position.set(-10 + index * 4, height / 2, zOffset);
                    bar.userData = {
                        value: value,
                        year: 2025 + index,
                        type: this.getSeriesName(color),
                        originalHeight: height
                    };

                    this.scene.add(bar);
                    this.chartObjects.push(bar);
                    bars.push(bar);

                    // Add value labels
                    this.createValueLabel(bar, value);
                });

                // Create connecting line
                this.createTrendLine(bars, color);

                return bars;
            }

            createTrendLine(bars, color) {
                const points = bars.map(bar => new THREE.Vector3(
                    bar.position.x,
                    bar.position.y + bar.geometry.parameters.height / 2,
                    bar.position.z
                ));

                const curve = new THREE.CatmullRomCurve3(points);
                const tubeGeometry = new THREE.TubeGeometry(curve, 20, 0.1, 8);
                const tubeMaterial = new THREE.MeshStandardMaterial({
                    color: color,
                    metalness: 0.8,
                    roughness: 0.2,
                    transparent: true,
                    opacity: 0.8
                });

                const tube = new THREE.Mesh(tubeGeometry, tubeMaterial);
                this.scene.add(tube);
                this.chartObjects.push(tube);
            }

            createConnectingSurfaces(data) {
                // Create surfaces between data series
                for (let i = 0; i < data.revenue.length - 1; i++) {
                    const points = [
                        new THREE.Vector3(-10 + i * 4, data.revenue[i] * 0.03, 2),
                        new THREE.Vector3(-10 + (i + 1) * 4, data.revenue[i + 1] * 0.03, 2),
                        new THREE.Vector3(-10 + (i + 1) * 4, data.expenses[i + 1] * 0.03, 0),
                        new THREE.Vector3(-10 + i * 4, data.expenses[i] * 0.03, 0)
                    ];

                    const geometry = new THREE.BufferGeometry().setFromPoints(points);
                    geometry.setIndex([0, 1, 2, 2, 3, 0]);

                    const material = new THREE.MeshStandardMaterial({
                        color: 0x00aaaa,
                        transparent: true,
                        opacity: 0.3,
                        side: THREE.DoubleSide
                    });

                    const surface = new THREE.Mesh(geometry, material);
                    this.scene.add(surface);
                    this.chartObjects.push(surface);
                }
            }

            createValueLabel(bar, value) {
                // Simplified label using geometry - in real implementation would use proper text rendering
                const labelGeometry = new THREE.PlaneGeometry(0.8, 0.2);
                const labelMaterial = new THREE.MeshBasicMaterial({
                    color: 0xffffff,
                    transparent: true,
                    opacity: 0.8
                });
                const label = new THREE.Mesh(labelGeometry, labelMaterial);
                label.position.set(
                    bar.position.x,
                    bar.position.y + bar.geometry.parameters.height / 2 + 1,
                    bar.position.z
                );
                label.lookAt(this.camera.position);
                this.scene.add(label);
                this.chartObjects.push(label);
            }

            createYearLabels(years) {
                years.forEach((year, index) => {
                    const labelGeometry = new THREE.PlaneGeometry(1, 0.3);
                    const labelMaterial = new THREE.MeshBasicMaterial({
                        color: 0x00ffff,
                        transparent: true,
                        opacity: 0.9
                    });
                    const label = new THREE.Mesh(labelGeometry, labelMaterial);
                    label.position.set(-10 + index * 4, -3, 6);
                    label.lookAt(this.camera.position);
                    this.scene.add(label);
                    this.chartObjects.push(label);
                });
            }

            createDataParticles(data) {
                const particleCount = 200;
                const geometry = new THREE.BufferGeometry();
                const positions = new Float32Array(particleCount * 3);
                const colors = new Float32Array(particleCount * 3);

                for (let i = 0; i < particleCount; i++) {
                    const i3 = i * 3;

                    // Distribute particles around data visualization
                    positions[i3] = (Math.random() - 0.5) * 30;
                    positions[i3 + 1] = Math.random() * 25;
                    positions[i3 + 2] = (Math.random() - 0.5) * 20;

                    // Colors matching the data series
                    const colorOptions = [
                        new THREE.Color(0x00ffff),
                        new THREE.Color(0xffff00),
                        new THREE.Color(0x00ff00),
                        new THREE.Color(0xff8800)
                    ];
                    const color = colorOptions[Math.floor(Math.random() * colorOptions.length)];
                    colors[i3] = color.r;
                    colors[i3 + 1] = color.g;
                    colors[i3 + 2] = color.b;
                }

                geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
                geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));

                const material = new THREE.PointsMaterial({
                    size: 0.2,
                    transparent: true,
                    opacity: 0.6,
                    vertexColors: true,
                    sizeAttenuation: true
                });

                const particles = new THREE.Points(geometry, material);
                this.scene.add(particles);
                this.chartObjects.push(particles);
                this.particles = particles;
            }

            getCurrentData() {
                const scenario = this.scenarios[this.currentScenario];
                const adjustedData = {};

                Object.entries(this.baseData).forEach(([key, values]) => {
                    adjustedData[key] = values.map((value, index) => {
                        let adjusted = value;

                        // Apply scenario adjustments
                        if (key === 'revenue' || key === 'profit') {
                            adjusted *= (1 + scenario.growth * (index / 5));
                        }

                        // Apply parameter adjustments
                        const marketFactor = this.parameters.marketGrowth / 35;
                        const acqFactor = this.parameters.customerAcq / 45;
                        const pricingFactor = 1 + (this.parameters.pricingPremium / 100);

                        adjusted *= marketFactor * acqFactor * pricingFactor;

                        // Apply risk factors
                        const totalRisk = (this.parameters.marketRisk + this.parameters.compRisk + this.parameters.techRisk) / 100;
                        adjusted *= (1 - totalRisk * 0.5);

                        return Math.max(adjusted, 0);
                    });
                });

                return adjustedData;
            }

            updateVisualization() {
                this.createVisualization();
                this.updateMetrics();
            }

            updateScenario() {
                this.recalculateProjections();
                this.updateVisualization();
            }

            recalculateProjections() {
                const data = this.getCurrentData();
                this.updateMetrics();

                // Animate chart updates
                this.animateChartUpdate(data);
            }

            animateChartUpdate(newData) {
                // Animate existing bars to new heights
                this.chartObjects.forEach(obj => {
                    if (obj.geometry && obj.geometry.type === 'BoxGeometry' && obj.userData.originalHeight) {
                        const series = this.getSeriesFromColor(obj.material.color);
                        const yearIndex = obj.userData.year - 2025;

                        if (newData[series] && newData[series][yearIndex] !== undefined) {
                            const newHeight = Math.max(newData[series][yearIndex] * 0.03, 0.1);
                            this.animateBarHeight(obj, newHeight);
                        }
                    }
                });
            }

            animateBarHeight(bar, targetHeight) {
                const startHeight = bar.scale.y;
                const startTime = Date.now();
                const duration = 1000;

                const animate = () => {
                    const elapsed = Date.now() - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    const easeProgress = this.easeInOutCubic(progress);

                    const currentHeight = startHeight + (targetHeight / bar.userData.originalHeight - startHeight) * easeProgress;
                    bar.scale.y = currentHeight;
                    bar.position.y = (bar.userData.originalHeight * currentHeight) / 2;

                    if (progress < 1) {
                        requestAnimationFrame(animate);
                    }
                };

                animate();
            }

            updateMetrics() {
                const data = this.getCurrentData();
                const scenario = this.scenarios[this.currentScenario];

                // Update metric values
                document.getElementById('revenueValue').textContent = `$${data.revenue[data.revenue.length - 1].toFixed(0)}M`;
                document.getElementById('arrValue').textContent = `$${(data.revenue[data.revenue.length - 1] * 0.95).toFixed(0)}M`;
                document.getElementById('marginValue').textContent = `${(((data.revenue[data.revenue.length - 1] - data.expenses[data.expenses.length - 1]) / data.revenue[data.revenue.length - 1]) * 100).toFixed(0)}%`;
                document.getElementById('valuationValue').textContent = `$${(data.revenue[data.revenue.length - 1] * 8 / 1000).toFixed(1)}B`;
                document.getElementById('customersValue').textContent = `${Math.floor(485 * (1 + scenario.growth))}`;
                document.getElementById('retentionValue').textContent = `${Math.floor(142 * (1 + scenario.margin))}%`;
            }

            highlightMetric(metric) {
                // Reset all chart objects
                this.chartObjects.forEach(obj => {
                    if (obj.material && obj.material.emissive) {
                        obj.material.emissive.setScalar(0.1);
                    }
                });

                // Highlight metric-specific objects
                const metricColors = {
                    revenue: 0x00ffff,
                    arr: 0x00ffff,
                    margin: 0x00ff00,
                    valuation: 0xffff00,
                    customers: 0xff8800,
                    retention: 0xff0088
                };

                if (metricColors[metric]) {
                    this.chartObjects.forEach(obj => {
                        if (obj.material && obj.material.color && obj.material.color.getHex() === metricColors[metric]) {
                            obj.material.emissive.setScalar(0.3);
                        }
                    });
                }
            }

            switchChartType(type) {
                switch(type) {
                    case '2d':
                        this.switch2DView();
                        break;
                    case 'table':
                        this.showTableView();
                        break;
                    case '3d':
                    default:
                        this.switch3DView();
                        break;
                }
            }

            switch2DView() {
                // Flatten the 3D visualization
                this.chartObjects.forEach(obj => {
                    if (obj.position) {
                        obj.position.z = 0;
                    }
                });

                // Adjust camera for 2D view
                this.camera.position.set(0, 0, 30);
                this.camera.lookAt(0, 0, 0);
            }

            switch3DView() {
                // Restore 3D positions
                this.createVisualization();

                // Restore 3D camera position
                this.camera.position.set(0, 15, 25);
                this.camera.lookAt(0, 0, 0);
            }

            showTableView() {
                // In a real implementation, this would show a data table overlay
                console.log('Table view - showing financial data in tabular format');
            }

            exportData() {
                const data = {
                    scenario: this.currentScenario,
                    period: this.currentPeriod,
                    parameters: this.parameters,
                    projections: this.getCurrentData(),
                    timestamp: new Date().toISOString()
                };

                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'aia-financial-projections.json';
                a.click();
                URL.revokeObjectURL(url);
            }

            getSeriesName(color) {
                const colorMap = {
                    0x00ffff: 'revenue',
                    0xffff00: 'expenses',
                    0x00ff00: 'profit',
                    0xff8800: 'cashflow'
                };
                return colorMap[color] || 'unknown';
            }

            getSeriesFromColor(color) {
                const hex = color.getHex();
                const colorMap = {
                    0x00ffff: 'revenue',
                    0xffff00: 'expenses',
                    0x00ff00: 'profit',
                    0xff8800: 'cashflow'
                };
                return colorMap[hex] || 'revenue';
            }

            selectPeriod(period) {
                document.querySelectorAll('.time-period').forEach(p => p.classList.remove('active'));
                document.querySelector(`[data-period="${period}"]`).classList.add('active');
                this.currentPeriod = period;
                this.updateVisualization();
            }

            selectScenario(scenario) {
                document.querySelectorAll('.scenario-btn').forEach(b => b.classList.remove('active'));
                document.querySelector(`[data-scenario="${scenario}"]`).classList.add('active');
                this.currentScenario = scenario;
                this.updateScenario();
            }

            onMouseMove(event) {
                const rect = this.renderer.domElement.getBoundingClientRect();
                this.mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
                this.mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;

                // Raycasting for hover effects
                this.raycaster.setFromCamera(this.mouse, this.camera);
                const intersects = this.raycaster.intersectObjects(this.chartObjects);

                if (intersects.length > 0) {
                    const obj = intersects[0].object;
                    if (obj.userData && obj.userData.value) {
                        this.showTooltip(event, obj.userData);
                    }
                } else {
                    this.hideTooltip();
                }
            }

            onClick(event) {
                this.raycaster.setFromCamera(this.mouse, this.camera);
                const intersects = this.raycaster.intersectObjects(this.chartObjects);

                if (intersects.length > 0) {
                    const obj = intersects[0].object;
                    if (obj.userData) {
                        console.log('Selected:', obj.userData);
                        // Could trigger detailed view or drill-down
                    }
                }
            }

            showTooltip(event, data) {
                const tooltip = document.getElementById('tooltip');
                tooltip.innerHTML = `
                    <strong>${data.type} (${data.year})</strong><br>
                    Value: $${data.value.toFixed(1)}M
                `;
                tooltip.style.left = event.clientX + 10 + 'px';
                tooltip.style.top = event.clientY - 10 + 'px';
                tooltip.classList.add('show');
            }

            hideTooltip() {
                document.getElementById('tooltip').classList.remove('show');
            }

            clearScene() {
                // Remove all chart objects
                this.chartObjects.forEach(obj => {
                    this.scene.remove(obj);
                    if (obj.geometry) obj.geometry.dispose();
                    if (obj.material) obj.material.dispose();
                });
                this.chartObjects = [];
            }

            easeInOutCubic(t) {
                return t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;
            }

            animate() {
                requestAnimationFrame(() => this.animate());

                const time = Date.now() * 0.001;

                // Animate particles
                if (this.particles) {
                    this.particles.rotation.y += 0.002;
                    this.particles.rotation.x += 0.001;
                }

                // Animate data lights
                this.dataLights.forEach((light, index) => {
                    light.intensity = 0.5 + Math.sin(time + index) * 0.3;
                });

                // Subtle animations for chart objects
                this.chartObjects.forEach((obj, index) => {
                    if (obj.geometry && obj.geometry.type === 'BoxGeometry') {
                        obj.rotation.y += Math.sin(time + index * 0.1) * 0.001;
                    }
                });

                // Update controls and render
                this.controls.update();
                this.composer.render();
            }

            handleResize() {
                const container = this.renderer.domElement.parentElement;

                this.camera.aspect = container.clientWidth / container.clientHeight;
                this.camera.updateProjectionMatrix();

                this.renderer.setSize(container.clientWidth, container.clientHeight);
                this.composer.setSize(container.clientWidth, container.clientHeight);
            }

            startAnimation() {
                this.animate();
                this.updateMetrics();
            }
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new FinancialDashboard();
        });
    </script>
</body>
</html>
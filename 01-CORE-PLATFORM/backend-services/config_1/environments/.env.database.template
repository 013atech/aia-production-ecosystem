# Database Connection Pool Configuration
# =====================================

# Primary Database URL (PostgreSQL + TimescaleDB recommended for production)
DATABASE_URL=postgresql://aia:${DB_PASSWORD}@${DB_HOST}:${DB_PORT}/aia_production

# Database Connection Pool Settings
DB_POOL_SIZE=20                    # Number of persistent connections in pool
DB_MAX_OVERFLOW=30                 # Maximum additional connections beyond pool_size
DB_POOL_TIMEOUT=30                 # Seconds to wait for connection from pool
DB_POOL_RECYCLE=3600              # Seconds after which to recycle connection (1 hour)
DB_CONNECT_TIMEOUT=10             # Connection timeout in seconds
DB_COMMAND_TIMEOUT=60             # SQL command timeout in seconds

# Database SSL and Security Settings
DB_SSL_MODE=require               # SSL mode: disable, allow, prefer, require, verify-ca, verify-full
DB_ECHO=false                     # Log all SQL statements (for debugging only)
DB_ECHO_POOL=false               # Log connection pool events (for debugging only)

# TimescaleDB Settings (if using TimescaleDB)
TIMESCALEDB_ENABLED=true          # Enable TimescaleDB-specific optimizations
TIMESCALEDB_LICENSE=apache        # License type: apache or community

# Async Database Pool Settings
ASYNC_DB_MIN_POOL_SIZE=5          # Minimum async connections
ASYNC_DB_MAX_POOL_SIZE=20         # Maximum async connections
ASYNC_DB_MAX_QUERIES=50000        # Max queries per connection
ASYNC_DB_MAX_INACTIVE_TIME=300    # Max inactive connection lifetime (seconds)
ASYNC_DB_COMMAND_TIMEOUT=60       # Async command timeout

# Performance Monitoring Settings
DB_SLOW_QUERY_THRESHOLD=1.0       # Seconds - queries slower than this are flagged
DB_CRITICAL_QUERY_THRESHOLD=5.0   # Seconds - critical slow query threshold
DB_PERFORMANCE_MONITORING=true    # Enable real-time performance monitoring
DB_PERFORMANCE_LOG_INTERVAL=30    # Performance logging interval in seconds

# Redis Configuration (for caching and session management)
REDIS_URL=redis://:${REDIS_PASSWORD}@${REDIS_HOST}:${REDIS_PORT}/0
REDIS_MAX_CONNECTIONS=100         # Maximum Redis connections
REDIS_CONNECT_TIMEOUT=5           # Redis connection timeout
REDIS_SOCKET_TIMEOUT=5            # Redis socket timeout

# Task Processor Configuration
TASK_PROCESSOR_WORKERS=10         # Number of background task workers
TASK_QUEUE_SIZE=1000              # Maximum task queue size
TASK_TIMEOUT_DEFAULT=3600         # Default task timeout (1 hour)

# Database Health Check Settings
DB_HEALTH_CHECK_INTERVAL=60       # Health check interval in seconds
DB_HEALTH_CHECK_TIMEOUT=5         # Health check timeout
DB_CONNECTION_RETRY_ATTEMPTS=3    # Number of retry attempts for failed connections
DB_CONNECTION_RETRY_DELAY=1       # Delay between retry attempts

# Backup and Recovery Settings
DB_BACKUP_ENABLED=true            # Enable automatic database backups
DB_BACKUP_INTERVAL=86400          # Backup interval in seconds (24 hours)
DB_BACKUP_RETENTION_DAYS=30       # Number of days to retain backups
DB_BACKUP_S3_BUCKET=${BACKUP_S3_BUCKET}  # S3 bucket for backup storage

# Database Migration Settings
DB_AUTO_MIGRATE=false             # Automatically run migrations on startup
DB_MIGRATION_TIMEOUT=300          # Migration timeout in seconds

# Monitoring and Alerting
DB_METRICS_ENABLED=true           # Enable database metrics collection
DB_ALERT_HIGH_UTILIZATION=80      # Alert when pool utilization exceeds this %
DB_ALERT_HIGH_ERROR_RATE=5        # Alert when error rate exceeds this %
DB_ALERT_SLOW_QUERIES=10          # Alert when slow queries exceed this count per hour

# Production Optimization Flags
DB_OPTIMIZE_FOR_READS=false       # Optimize settings for read-heavy workloads
DB_OPTIMIZE_FOR_WRITES=false      # Optimize settings for write-heavy workloads
DB_ENABLE_QUERY_CACHE=true        # Enable query result caching
DB_ENABLE_CONNECTION_WARMUP=true  # Pre-warm connection pool on startup

# Development and Testing Settings
DB_SEED_DATA=false                # Load seed data on startup
DB_RESET_ON_STARTUP=false         # Reset database on startup (DANGER: data loss!)
DB_MOCK_SLOW_QUERIES=false        # Simulate slow queries for testing

# Compliance and Auditing
DB_AUDIT_ENABLED=false            # Enable database operation auditing
DB_AUDIT_LOG_LEVEL=INFO           # Audit log level: DEBUG, INFO, WARNING, ERROR
DB_ENCRYPT_AT_REST=true           # Enable database encryption at rest
DB_ENCRYPT_IN_TRANSIT=true        # Enforce SSL/TLS for all connections

# Example Production Values:
# =========================
# For High-Traffic Production (>10k concurrent users):
# DB_POOL_SIZE=50
# DB_MAX_OVERFLOW=100
# ASYNC_DB_MAX_POOL_SIZE=50
# TASK_PROCESSOR_WORKERS=20

# For Medium-Traffic Production (1k-10k concurrent users):
# DB_POOL_SIZE=20
# DB_MAX_OVERFLOW=30
# ASYNC_DB_MAX_POOL_SIZE=20
# TASK_PROCESSOR_WORKERS=10

# For Development/Testing:
# DB_POOL_SIZE=5
# DB_MAX_OVERFLOW=10
# ASYNC_DB_MAX_POOL_SIZE=5
# TASK_PROCESSOR_WORKERS=3
# DB_ECHO=true
# DB_PERFORMANCE_MONITORING=false